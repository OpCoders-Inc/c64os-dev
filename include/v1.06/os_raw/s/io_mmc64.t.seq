;----[ IO¤MMC64.T ]---------------------;ÍÍÃ64 USES ÓERIAL ÐERIPHERAL ÉNTERFACE;(ÓÐÉ) FOR COMMUNICATIONS WITH ÍÍÃ AND;ÓÄ ÃARDS, AND ALSO WITH AN ÒÔÃ CHIP.;ÍÍÃ64 ÒEGISTERSMMC¤SPI  = $DF10 ;ÓÐÉ  TRANSFER REGISTERMMC¤CTL  = $DF11 ;ÍÍÃ64 CONTROL REGISTERMMC¤STA  = $DF12 ;ÍÍÃ64  STATUS REGISTERMMC¤IDY  = $DF13 ;ÍÍÃ64  IDENT. REGISTER;ÍÍÃ64 ÉDENTITY ÒEGISTER ÖALUES;ÒEAD IF ÍÍÃ64 IS PRESENT AND ENABLED.MMI¤CARD = $64 ;×HEN CARD SELECTEDMMI¤REVA = $01 ;ÃARD NOT SELECTED, ÒEV.ÁMMI¤REVB = $02 ;ÃARD NOT SELECTED, ÒEV.Â;×RITE MMI¤UNL1 THEN WRITE MMI¤UNL2 TO;UNLOCK. ÔHEN WRITE MCR¤DACT TO MMC¤CTL;TO DISABLE ÍÍÃ64 WITHOUT UNPLUGGING IT.MMI¤UNL1 = %01010101 ;ÕNLOCK ÓTAGE 1MMI¤UNL2 = %10101010 ;ÕNLOCK ÓTAGE 2;×HEN ÍÍÃ64 HAS BEEN DISABLED, WRITE;MMI¤ENA1 THEN WRITE MMI¤ENA2 TO MMC¤IDYMMI¤ENA1 = %00001010 ;ÅNABLE ÓTAGE 1MMI¤ENA2 = %00011100 ;ÅNABLE ÓTAGE 2;ÍÍÃ64 ÃONTROL ÒEGISTER ÂITS;ÆIRST READ THE MMC¤CTL REGISTER.;ÔHEN FLIP ONE OF THE BITS.;×RITE RESULT BACK TO MMC¤CTL REGISTER.MCR¤DACT = %10000000;ORA #MCR¤DACT     ;ÄEACTIVATE ÍÍÃ64;AND #MCR¤DACT:$FF ;ÁCTIVATE   ÍÍÃ64MCR¤TRGR = %01000000;ORA #MCR¤TRGR     ;ÔRIGGER ON ÒEAD;AND #MCR¤TRGR:$FF ;ÔRIGGER ON ×RITEMCR¤DXRM = %00100000;ORA #MCR¤DXRM     ;ÄISABLE ÅØ ÒÏÍ;AND #MCR¤DXRM:$FF ;ÅNABLE  ÅØ ÒÏÍMCR¤FLMD = %00010000;ORA #MCR¤FLMD     ;ÆLASH ÕPDATE ÍODE;AND #MCR¤FLMD:$FF ;ÎORMAL ÍODEMCR¤FAST = %00000100;ORA #MCR¤FAST     ;  8ÍÈZ ÃLOCK ÓPEED;AND #MCR¤FAST:$FF ;250ËÈZ ÃLOCK ÓPEEDMCR¤NCRD = %00000010;ORA #MCR¤NCRD     ;ÃARD ÎOT ÓELECTED;AND #MCR¤NCRD:$FF ;ÃARD ÓELECTEDMCR¤DBIO = %00000001;ORA #MCR¤DBIO     ;ÄISABLE ÂÉÏÓ ÒÏÍ;ORA #MCR¤DBIO:$FF ;ÅNABLE  ÂÉÏÓ ÒÏÍ;ÁCCESSING THE ÒÔÃMCR¤RTC  = MCR¤FLMD.MCR¤NCRD.MCR¤DBIO;ORA #MCR¤RTC      ;ÁCCESS THE ÒÔÃ;AND #MCR¤FAST:$FF ;ÒÔÃ NEEDS 250ËÈZ ÃLK;ÍÍÃ64 ÓTATUS ÒEGISTER ÂITS (ÒEAD-ÏNLY)MSR¤WRTP = %00010000 ;ÍÍÃ ×RITE ÐROTECTMSR¤NCRD = %00001000 ;ÎO ÃARD ÐRESENTMSR¤BUSY = %00000001 ;ÂUSY WAIT STATE;ÔHE ÐÆÃ2123 IS AN ÓÐÉ ÒÔÃ CLOCK CHIP;BUILT INTO THE ÍÍÃ64 CARTRIDGE.;ÐÆÃ2123 ÒEGISTERSPFC¤CT1  = $00 ;ÃONTROL 1PFC¤CT2  = $01 ;ÃONTROL 2PFC¤SECS = $02 ;ÓECONDSPFC¤MINS = $03 ;ÍINUTESPFC¤HOUR = $04 ;ÈOURSPFC¤DATE = $05 ;ÄATE OF ÍONTHPFC¤DOW  = $06 ;ÄAY OF ×EEK ($00 = ÓUN.)PFC¤MNTH = $07 ;ÍONTH       ($01 = ÊAN.)PFC¤YEAR = $08 ;ÙEAR        (ÎO ÃENTURY);ÐÆÃ2123 ÃOMMAND ÂITSPFC¤READ = %10000000;ORA #%PFC¤READ     ;ÒEAD ÍODE;AND #%PFC¤READ:$FF ;×RITE ÍODEPFC¤SUBA = %00010000;ORA #%PFC¤SUBA     ;ÃOMMAND ÓUBÁDDRESS;ÉF THE ÓUBÁDDRESS BIT IS NOT SET IN THE;COMMAND, THE DATA TRANSFER IS IGNORED.